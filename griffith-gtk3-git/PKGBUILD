# Maintainer: ValHue <vhuelamo at gmail dot com>
# https://github.com/ValHue/AUR-PKGBUILDs
#
# Maintainer: Strit <danjohansen at strits dot dk>
#
# Contributor: Jaroslav Lichtblau <dragonlord at aur dot archlinux dot org>
# Contributor: Daniel J Griffiths <ghost1227 at archlinux dot us>
# Contributor: Ronald van Haren <ronald at archlinux dot org>
# Contributor: Alessio 'mOLOk' Bolognino <themolok at gmail dot com>
# Contributor: Pawel Rusinek <p.rusinek at gmail dot com>
# Contributor: Jashua Gentry <https://gitlab.com/pixel293>

pkgname="griffith-gtk3-dev"
_pkgname="griffith"
pkgver=0.15
pkgrel=2
_gitcommit=05b5803f770818d6309b0946e77de6e523b51fc9
pkgdesc="Movie collection manager application"
arch=('any')
url="https://gitlab.com/strit/griffith"
license=('GPL2')
provides=("griffith")
depends=('python-gobject' 'sqlite' 'python-reportlab' 'python-pillow' 'python-sqlalchemy')
optdepends=('python-psycopg2: postgreSQL support'
            'mysql-python: MySQL support'
            'python-chardet: encoding detection of imported CSV files'
            'python-gtkspell: spell checking support'
            'griffith-extra-artwork: additional icons'
            'python-tmdbsimple: For TMDB Import support')
source=("$_pkgname-$_gitcommit-$pkgrel.tar.gz::$url/repository/master/archive.tar.gz")
sha256sums=('SKIP')

build() {
    #cd "${pkgname}-${pkgver}"
    cd "${_pkgname}-master-${_gitcommit}"
    
    # python2 fix
    #sed -i 's_#!.*/usr/bin/env.*python_#!/usr/bin/env python2_' griffith

    # new bash_completion directory
    sed -e 's,BASHCOMPDIR = $(ETCDIR)/bash_completion.d,BASHCOMPDIR = $(PREFIX)/share/bash-completion/completions,' -i Makefile

    # The version 0.13.0 of griffith isn't compatible with SqlAlchemy 0.8.
    # http://forum.griffith.cc/index.php/topic,1601.msg5317.html#msg5317
	#cp -f ../validators.py ./lib/db/validators.py

	## Thanks to Strit
	# Update PluginMovieIMDB.py to version 1.15
	# http://www.strits.dk/files/PluginMovieIMDB.py
	#cp -f ../PluginMovieIMDB.py ./lib/plugins/movie/PluginMovieIMDB.py

	# Update PluginExportPDF.py
	# http://www.strits.dk/files/PluginExportPDF.py
	#cp -f ../PluginExportPDF.py ./lib/plugins/export/PluginExportPDF.py

	# Fix dependencies version
	#sed -i '65,83d' griffith

	# Fix to AttributeError: 'module' object has no attribute 'glade'
	#sed -i "35i\import gtk.glade" ./lib/initialize.py

	# Fix to import movie info
	#cd ./lib
	#patch  < ${srcdir}/movie_py.patch
}

package() {
    #cd "${pkgname}-${pkgver}"
    cd "${_pkgname}-master-${_gitcommit}"

    make DESTDIR=${pkgdir} install

    # The program creates a wrong symlink so make a new one
	rm ${pkgdir}/usr/bin/griffith
	ln -s /usr/share/griffith/lib/griffith ${pkgdir}/usr/bin/griffith

    # The program creates a etc directory empty
    rm -rf ${pkgdir}/etc
}

# vim:set ts=4 sw=2 ft=sh et:
